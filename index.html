<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload PDF and Download Excel</title>
    <style>
        /* Estilos para o botão e o carregamento */
        #loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
        }
    </style>
</head>
<body>

    <!-- Formulário para upload do PDF -->
    <h1>Upload PDF e Baixar Excel</h1>
    <input type="file" id="fileInput" accept=".pdf" />
    <button id="uploadButton">Enviar PDF</button>
    
    <!-- Loader -->
    <div id="loader">Carregando...</div>

    <script>
        document.getElementById('uploadButton').addEventListener('click', function() {
            // Pega o arquivo PDF do input
            var fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert("Por favor, selecione um arquivo PDF.");
                return;
            }

            var file = fileInput.files[0];
            var formData = new FormData();
            formData.append("file", file);

            // Exibe o carregamento
            document.getElementById('loader').style.display = 'block';

            // Realiza a requisição HTTP para a função da API
            fetch('https://occextractprocessfile.azurewebsites.net/api/ProcessFile?code=jUbw-0eziPyHiTC5ZfVfQkAdMzr2hI-zQ2hPlrxWpzZjAzFuv70J4Q%3D%3D', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();  // Converte a resposta para blob (arquivo)
                } else {
                    throw new Error("Erro ao processar o arquivo.");
                }
            })
            .then(blob => {
                // Esconde o loader
                document.getElementById('loader').style.display = 'none';

                // Cria um link para o download do arquivo Excel gerado
                var link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'arquivo_resultado.xlsx'; // Nome do arquivo para download
                link.click();
            })
            .catch(error => {
                // Esconde o loader em caso de erro
                document.getElementById('loader').style.display = 'none';
                alert('Erro ao processar o arquivo: ' + error.message);
            });
        });
    </script>

</body>
</html>
